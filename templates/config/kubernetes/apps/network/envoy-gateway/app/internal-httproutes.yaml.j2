#| =========================================================================== #|
#| CENTRALIZED HTTPROUTES - All internal web UIs routed through envoy-internal #|
#| =========================================================================== #|
#| HTTPRoutes are centralized in the 'network' namespace to enable:            #|
#|   - Consistent SecurityPolicy application (OIDC/JWT protection)             #|
#|   - Simplified route management                                             #|
#|   - Cross-namespace backend references via ReferenceGrant                   #|
#|                                                                             #|
#| Routes that should NOT be OIDC-protected (Keycloak, webhooks) remain in     #|
#| their original namespaces.                                                  #|
#| =========================================================================== #|

#| =========================================================================== #|
#| HUBBLE UI - Cilium network observability dashboard                          #|
#| =========================================================================== #|
#% if hubble_enabled | default(false) %#
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: hubble-ui
  namespace: network
  labels:
#% if oidc_sso_enabled | default(false) %#
    security: oidc-protected
#% endif %#
spec:
  hostnames:
    - "#{ hubble_subdomain | default('hubble') }#.${SECRET_DOMAIN}"
  parentRefs:
    - name: envoy-internal
      namespace: network
      sectionName: https
  rules:
    - backendRefs:
        - name: hubble-ui
          namespace: kube-system
          port: 80
      matches:
        - path:
            type: PathPrefix
            value: /
#% endif %#

#| =========================================================================== #|
#| GRAFANA - Metrics visualization dashboard                                   #|
#| =========================================================================== #|
#% if monitoring_enabled | default(false) and monitoring_stack == 'prometheus' %#
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: grafana
  namespace: network
  labels:
#% if oidc_sso_enabled | default(false) %#
    security: oidc-protected
#% endif %#
spec:
  hostnames:
    - "#{ grafana_subdomain | default('grafana') }#.${SECRET_DOMAIN}"
  parentRefs:
    - name: envoy-internal
      namespace: network
      sectionName: https
  rules:
    - backendRefs:
        - name: kube-prometheus-stack-grafana
          namespace: #{ observability_namespace | default('monitoring') }#
          port: 80
      matches:
        - path:
            type: PathPrefix
            value: /
#% endif %#

#| =========================================================================== #|
#| RUSTFS CONSOLE - S3-compatible object storage management UI                 #|
#| =========================================================================== #|
#% if rustfs_enabled | default(false) %#
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: rustfs-console
  namespace: network
  labels:
#% if oidc_sso_enabled | default(false) %#
    security: oidc-protected
#% endif %#
spec:
  hostnames:
    - "#{ rustfs_subdomain | default('rustfs') }#.${SECRET_DOMAIN}"
  parentRefs:
    - name: envoy-internal
      namespace: network
      sectionName: https
  rules:
    - backendRefs:
        - name: rustfs-svc
          namespace: storage
          port: 9001
      matches:
        - path:
            type: PathPrefix
            value: /
#% endif %#
