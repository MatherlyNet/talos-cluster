#% if monitoring_enabled | default(false) and loki_enabled | default(false) and rustfs_enabled | default(false) %#
---
#| =========================================================================== #|
#| Loki S3 Credentials for RustFS Backend Storage                              #|
#| =========================================================================== #|
#| RustFS does NOT support 'mc admin' commands for creating users/policies.    #|
#| Access keys must be created manually via the RustFS Console UI.             #|
#|                                                                             #|
#| SETUP STEPS:                                                                #|
#|   1. Ensure RustFS is running and healthy                                   #|
#|   2. Access RustFS Console at https://rustfs.<your-domain>                  #|
#|   3. Login with root credentials (RUSTFS_ACCESS_KEY / RUSTFS_SECRET_KEY)    #|
#|   4. Navigate to: Identity -> Users -> Create Access Key                    #|
#|   5. Copy the generated access key and secret key                           #|
#|   6. Update cluster.yaml:                                                   #|
#|        loki_s3_access_key: "<generated-access-key>"                         #|
#|        loki_s3_secret_key: "<generated-secret-key>"                         #|
#|   7. Run 'task configure' to regenerate this secret                         #|
#|   8. Run 'task reconcile' to apply changes                                  #|
#|                                                                             #|
#| Reference: https://docs.rustfs.com/administration/iam/access-token.html     #|
#| =========================================================================== #|
apiVersion: v1
kind: Secret
metadata:
  name: loki-s3-credentials
type: Opaque
stringData:
  #| These env vars are referenced by Loki HelmRelease via extraEnvFrom #|
  LOKI_S3_ACCESS_KEY: "#{ loki_s3_access_key | default('PLACEHOLDER_CREATE_IN_RUSTFS_CONSOLE') }#"
  LOKI_S3_SECRET_KEY: "#{ loki_s3_secret_key | default('PLACEHOLDER_CREATE_IN_RUSTFS_CONSOLE') }#"
#% endif %#