#% if litellm_enabled | default(false) %#
---
#| ============================================================================= #|
#| LITELLM SECRETS - Core application credentials                               #|
#| All sensitive values are SOPS-encrypted via Age                              #|
#| REF: docs/research/litellm-proxy-gateway-integration-jan-2026.md             #|
#| ============================================================================= #|
apiVersion: v1
kind: Secret
metadata:
  name: litellm-secret
  namespace: ai-system
  labels:
    app.kubernetes.io/name: litellm
    app.kubernetes.io/component: credentials
type: Opaque
stringData:
  #| LiteLLM Core Settings #|
  LITELLM_MASTER_KEY: "#{ litellm_master_key }#"
  LITELLM_SALT_KEY: "#{ litellm_salt_key }#"

  #| Database URL (CloudNativePG) #|
  #| sslmode=disable is safe for internal cluster communication (Cilium provides encryption) #|
  DATABASE_URL: "postgresql://#{ litellm_db_user | default('litellm') }#:#{ litellm_db_password }#@litellm-postgresql-rw.ai-system.svc.cluster.local:5432/#{ litellm_db_name | default('litellm') }#?sslmode=disable"

  #| Dragonfly (Redis-compatible) Cache - Uses shared Dragonfly in cache namespace #|
  #| Authenticates as 'litellm' user with ACL limited to litellm:* key prefix #|
  REDIS_PASSWORD: "#{ dragonfly_litellm_password }#"
  REDIS_URL: "redis://litellm:#{ dragonfly_litellm_password }#@dragonfly.cache.svc.cluster.local:6379/0"

#% if azure_openai_us_east_api_key %#
  #| Azure OpenAI US East #|
  AZURE_API_KEY: "#{ azure_openai_us_east_api_key }#"
#% endif %#

#% if azure_openai_us_east2_api_key %#
  #| Azure OpenAI US East2 #|
  AZURE_API_KEY_EAST2: "#{ azure_openai_us_east2_api_key }#"
#% endif %#

#% if azure_cohere_rerank_api_key %#
  #| Azure Cohere Rerank API #|
  AZURE_COHERE_RERANK_API_KEY: "#{ azure_cohere_rerank_api_key }#"
#% endif %#

#% if azure_cohere_embed_api_key %#
  #| Azure Cohere Embed API #|
  AZURE_COHERE_EMBED_API_KEY: "#{ azure_cohere_embed_api_key }#"
#% endif %#

#% if azure_anthropic_api_key %#
  #| Azure Anthropic API (Claude models via Azure AI) #|
  AZURE_ANTHROPIC_API_KEY: "#{ azure_anthropic_api_key }#"
#% endif %#

#% if litellm_langfuse_enabled | default(false) %#
  #| Langfuse Observability #|
  LANGFUSE_PUBLIC_KEY: "#{ litellm_langfuse_public_key }#"
  LANGFUSE_SECRET_KEY: "#{ litellm_langfuse_secret_key }#"
#% endif %#

#% if litellm_oidc_enabled | default(false) %#
  #| Keycloak OIDC Client Secret #|
  OIDC_CLIENT_SECRET: "#{ litellm_oidc_client_secret }#"
#% endif %#

#% if litellm_alerting_enabled | default(false) %#
  #| Alerting Webhooks #|
#% if litellm_slack_webhook_url %#
  SLACK_WEBHOOK_URL: "#{ litellm_slack_webhook_url }#"
#% endif %#
#% if litellm_discord_webhook_url %#
  DISCORD_WEBHOOK_URL: "#{ litellm_discord_webhook_url }#"
#% endif %#
#% endif %#
---
#| ============================================================================= #|
#| DATABASE CREDENTIALS - PostgreSQL connection                                  #|
#| Used by CNPG Cluster bootstrap and managed.roles for password rotation        #|
#| REF: docs/research/cnpg-managed-roles-password-rotation-jan-2026.md           #|
#| ============================================================================= #|
apiVersion: v1
kind: Secret
metadata:
  name: litellm-db-secret
  namespace: ai-system
  labels:
    app.kubernetes.io/name: litellm-postgresql
    app.kubernetes.io/component: database-credentials
    #| CRITICAL: Required for CNPG to detect password changes and trigger rotation #|
    cnpg.io/reload: "true"
#| Type must be kubernetes.io/basic-auth for CNPG managed roles #|
type: kubernetes.io/basic-auth
stringData:
  username: "#{ litellm_db_user | default('litellm') }#"
  password: "#{ litellm_db_password }#"
#% if litellm_backup_enabled | default(false) %#
---
#| ============================================================================= #|
#| BACKUP CREDENTIALS - RustFS S3 storage for PostgreSQL backups                #|
#| Create via RustFS Console: user + litellm-storage policy                     #|
#| REF: docs/guides/keycloak-implementation.md#backup-strategy                  #|
#| ============================================================================= #|
apiVersion: v1
kind: Secret
metadata:
  name: litellm-backup-credentials
  namespace: ai-system
  labels:
    app.kubernetes.io/name: litellm
    app.kubernetes.io/component: backup-credentials
type: Opaque
stringData:
  ACCESS_KEY_ID: "#{ litellm_s3_access_key }#"
  SECRET_ACCESS_KEY: "#{ litellm_s3_secret_key }#"
#% endif %#
#% endif %#
