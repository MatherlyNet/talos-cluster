#% if obot_enabled | default(false) %#
---
#| ============================================================================= #|
#| OBOT SECRETS - Core application credentials                                   #|
#| All sensitive values are SOPS-encrypted via Age                               #|
#| REF: docs/research/obot-mcp-gateway-integration-jan-2026.md                   #|
#| ============================================================================= #|
apiVersion: v1
kind: Secret
metadata:
  name: obot-secret
  namespace: ai-system
  labels:
    app.kubernetes.io/name: obot
    app.kubernetes.io/component: credentials
type: Opaque
stringData:
  #| Database password for PostgreSQL connection #|
  OBOT_DB_PASSWORD: "#{ obot_db_password }#"

  #| Encryption key for credential storage (32 bytes base64) #|
  #| Generate with: openssl rand -base64 32 #|
  OBOT_SERVER_ENCRYPTION_KEY: "#{ obot_encryption_key }#"

#% if obot_bootstrap_token | default('') %#
  #| Bootstrap token for initial setup #|
  OBOT_BOOTSTRAP_TOKEN: "#{ obot_bootstrap_token }#"
#% endif %#

#% if obot_keycloak_enabled | default(false) %#
  #| Keycloak OIDC client secret #|
  #| Key name must match jrmatherly/obot-entraid auth provider expectations #|
  OBOT_KEYCLOAK_AUTH_PROVIDER_CLIENT_SECRET: "#{ obot_keycloak_client_secret }#"

  #| Cookie encryption secret for auth provider (32 bytes base64) #|
  #| Generate with: openssl rand -base64 32 #|
  #| Key name must match jrmatherly/obot-entraid auth provider expectations #|
  #| NOTE: This is NOT prefixed with KEYCLOAK - it's the shared auth provider cookie secret #|
  OBOT_AUTH_PROVIDER_COOKIE_SECRET: "#{ obot_keycloak_cookie_secret }#"
#% endif %#

#% if obot_entra_tenant_id | default('') %#
  #| Entra ID (Azure AD) credentials #|
  #| Key names must match jrmatherly/obot-entraid auth provider expectations #|
  OBOT_ENTRA_AUTH_PROVIDER_CLIENT_ID: "#{ obot_entra_client_id }#"
  OBOT_ENTRA_AUTH_PROVIDER_CLIENT_SECRET: "#{ obot_entra_client_secret }#"
#% endif %#

#% if obot_workspace_provider | default('directory') == 's3' %#
  #| S3 workspace provider credentials #|
  #| Key names must match AWS SDK expectations #|
  AWS_ACCESS_KEY_ID: "#{ obot_s3_access_key }#"
  AWS_SECRET_ACCESS_KEY: "#{ obot_s3_secret_key }#"
#% endif %#
---
#| ============================================================================= #|
#| DATABASE CREDENTIALS - PostgreSQL connection                                  #|
#| Used by CNPG Cluster bootstrap to create database owner                       #|
#| ============================================================================= #|
apiVersion: v1
kind: Secret
metadata:
  name: obot-db-secret
  namespace: ai-system
  labels:
    app.kubernetes.io/name: obot-postgresql
    app.kubernetes.io/component: database-credentials
type: Opaque
stringData:
  username: "#{ obot_postgres_user | default('obot') }#"
  password: "#{ obot_db_password }#"
#% if obot_backup_enabled | default(false) %#
---
#| ============================================================================= #|
#| BACKUP CREDENTIALS - RustFS S3 storage for PostgreSQL backups                #|
#| Create via RustFS Console: user + obot-storage policy                        #|
#| REF: docs/guides/keycloak-implementation.md#backup-strategy                  #|
#| ============================================================================= #|
apiVersion: v1
kind: Secret
metadata:
  name: obot-backup-credentials
  namespace: ai-system
  labels:
    app.kubernetes.io/name: obot
    app.kubernetes.io/component: backup-credentials
type: Opaque
stringData:
  ACCESS_KEY_ID: "#{ obot_s3_access_key }#"
  SECRET_ACCESS_KEY: "#{ obot_s3_secret_key }#"
#% endif %#
#% endif %#
