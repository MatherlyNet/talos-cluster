#| =========================================================================== #|
#| REFERENCEGRANTS - Allow cross-namespace backend references                  #|
#| =========================================================================== #|
#| Gateway API requires explicit grants for HTTPRoutes in one namespace to     #|
#| reference Services in another namespace. These grants are placed in the     #|
#| TARGET namespace (where the Service lives).                                 #|
#|                                                                             #|
#| Pattern: HTTPRoute (network) → ReferenceGrant (target-ns) → Service         #|
#| =========================================================================== #|

#| =========================================================================== #|
#| KUBE-SYSTEM - Allow network namespace to reference Hubble UI service        #|
#| =========================================================================== #|
#% if hubble_enabled | default(false) %#
---
apiVersion: gateway.networking.k8s.io/v1beta1
kind: ReferenceGrant
metadata:
  name: allow-network-httproutes
  namespace: kube-system
spec:
  from:
    - group: gateway.networking.k8s.io
      kind: HTTPRoute
      namespace: network
  to:
    - group: ""
      kind: Service
      name: hubble-ui
#% endif %#

#| =========================================================================== #|
#| MONITORING - Allow network namespace to reference Grafana service           #|
#| =========================================================================== #|
#% if monitoring_enabled | default(false) and monitoring_stack == 'prometheus' %#
---
apiVersion: gateway.networking.k8s.io/v1beta1
kind: ReferenceGrant
metadata:
  name: allow-network-httproutes
  namespace: #{ observability_namespace | default('monitoring') }#
spec:
  from:
    - group: gateway.networking.k8s.io
      kind: HTTPRoute
      namespace: network
  to:
    - group: ""
      kind: Service
      name: kube-prometheus-stack-grafana
#% endif %#

#| =========================================================================== #|
#| STORAGE - Allow network namespace to reference RustFS service               #|
#| =========================================================================== #|
#% if rustfs_enabled | default(false) %#
---
apiVersion: gateway.networking.k8s.io/v1beta1
kind: ReferenceGrant
metadata:
  name: allow-network-httproutes
  namespace: storage
spec:
  from:
    - group: gateway.networking.k8s.io
      kind: HTTPRoute
      namespace: network
  to:
    - group: ""
      kind: Service
      name: rustfs-svc
#% endif %#
