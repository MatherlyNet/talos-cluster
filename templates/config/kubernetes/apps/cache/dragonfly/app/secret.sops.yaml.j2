#% if dragonfly_enabled | default(false) %#
---
apiVersion: v1
kind: Secret
metadata:
  name: dragonfly-auth
type: Opaque
stringData:
  password: "#{ dragonfly_password }#"
#% if dragonfly_backup_enabled | default(false) %#
  #| S3 credentials for RustFS backup #|
  AWS_ACCESS_KEY_ID: "#{ dragonfly_s3_access_key }#"
  AWS_SECRET_ACCESS_KEY: "#{ dragonfly_s3_secret_key }#"
#% endif %#
#% if dragonfly_acl_enabled | default(false) %#
  #| ACL configuration for multi-tenant access #|
  #| Note: +@connection required for PING, AUTH, CLIENT commands #|
  acl.conf: |
    user default on >#{ dragonfly_password }# ~* +@all
#% if dragonfly_keycloak_password | default('') %#
    user keycloak on >#{ dragonfly_keycloak_password }# ~keycloak:* +@read +@write +@connection -@dangerous
#% endif %#
#% if dragonfly_appcache_password | default('') %#
    user appcache on >#{ dragonfly_appcache_password }# ~cache:* +@read +@write +@connection -@dangerous
#% endif %#
#% if dragonfly_litellm_password | default('') %#
    user litellm on >#{ dragonfly_litellm_password }# ~litellm:* +@read +@write +@connection -@dangerous
#% endif %#
#% if dragonfly_langfuse_password | default('') %#
    #| Note: Langfuse doesn't support key prefix, requires ~* for all keys #|
    user langfuse on >#{ dragonfly_langfuse_password }# ~* +@read +@write +@connection -@dangerous
#% endif %#
#% endif %#
#% endif %#
