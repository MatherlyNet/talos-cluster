apiVersion: k8s.keycloak.org/v2alpha1
kind: KeycloakRealmImport
metadata:
  name: matherlynet-realm
  namespace: identity
spec:
  keycloakCRName: keycloak
  realm:
    realm: matherlynet
    enabled: true
    displayName: Matherlynet Realm
    ssoSessionIdleTimeout: 1800
    ssoSessionMaxLifespan: 36000
    accessTokenLifespan: 300
    accessTokenLifespanForImplicitFlow: 900
    registrationAllowed: false
    resetPasswordAllowed: true
    rememberMe: true
    loginWithEmailAllowed: true
    duplicateEmailsAllowed: false
    bruteForceProtected: true
    permanentLockout: false
    maxFailureWaitSeconds: 900
    minimumQuickLoginWaitSeconds: 60
    waitIncrementSeconds: 60
    quickLoginCheckMilliSeconds: 1000
    maxDeltaTimeSeconds: 43200
    failureFactor: 5
    roles:
      realm:
        - name: admin
          description: Full administrative access to all applications and settings
        - name: operator
          description: Operational access - manage services, view logs, restart pods
        - name: developer
          description: Development access - CI/CD, debugging tools, dev environments
        - name: viewer
          description: Read-only access to dashboards and status pages
        - name: user
          description: Basic authenticated user access to standard applications
    clients:
      - clientId: ENC[AES256_GCM,data:hlBrEcsqAe2z2iLrBQ==,iv:fVkMoU4feqYAG8CEaf7hWIHd+ttCa8Y06FB243AhkMU=,tag:nmaU2b8CUFFHj1TbcuOF8Q==,type:str]
        name: Envoy Gateway SSO
        description: OIDC client for Envoy Gateway SecurityPolicy - enables browser SSO across all protected applications
        enabled: true
        publicClient: false
        clientAuthenticatorType: client-secret
        secret: ENC[AES256_GCM,data:qAPhJJpPeEiTNr8mEWeIR+qrjJnZnP6j2rSXaIF+JQpvZIaVYI77SYP1HL4=,iv:tta0RkNeah101ukdCL9RFHE8k74019STyOHwgPFnQA0=,tag:lEqJlcr6HUzWu1Kp1ie5bg==,type:str]
        standardFlowEnabled: true
        directAccessGrantsEnabled: false
        serviceAccountsEnabled: false
        implicitFlowEnabled: false
        protocol: openid-connect
        redirectUris:
          - https://*.matherly.net/oauth2/callback
        webOrigins:
          - https://*.matherly.net
        attributes:
          pkce.code.challenge.method: S256
          post.logout.redirect.uris: https://*.matherly.net/*
        defaultClientScopes:
          - openid
          - profile
          - email
        optionalClientScopes:
          - address
          - phone
          - offline_access
    identityProviders:
      - alias: google
        displayName: Google
        providerId: google
        enabled: true
        trustEmail: true
        storeToken: true
        linkOnly: false
        firstBrokerLoginFlowAlias: first broker login
        config:
          clientId: ENC[AES256_GCM,data:tpvIrY4MCx8XgVmLWdPvtyT9/twOkErYuKyZPuTWPKAyfuQvajZhhuERu0ZGZtEjGqR+CFERWZjQPU5VW1bhWph3Tsv5RnGR,iv:zdLksPKj4YH8OWtlE0j+AQIkiQ14XXET5qp+/Nv6/t0=,tag:lBMgy8tSrhN1zCqAzuwQXQ==,type:str]
          clientSecret: ENC[AES256_GCM,data:/Sl1XzJNKF5UL/c1WzZmHJtbfV1kvJM/Vn8O0uoOOX4d8Wk=,iv:7HABRgHzDp1ufXjjMG4c3wlkVQeD1bsazS762e9EegQ=,tag:bkrqL/9CSTYnx7LY4ef0XA==,type:str]
          defaultScope: openid profile email
          syncMode: IMPORT
    identityProviderMappers:
      - name: google-default-role
        identityProviderAlias: google
        identityProviderMapper: oidc-hardcoded-role-idp-mapper
        config:
          syncMode: INHERIT
          role: admin
sops:
  age:
    - recipient: age1rqvr6f3l6hxc5dn9q2n7edzvrklj2sz3q9djlp9rtqc8hfa6447saqpaqn
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSB3QktOS21KbHcya2xMRHNF
        cFBoZGlXYjhkSngwTkNrREtMY1FKSldiZlFZCjVxaXJwZy9WUjFTdnpwY0JuN3hj
        R0pOR0FSUkR5SmxPOTRWREFQYlVlbHMKLS0tIHRKRFVhN2tuNFpnVEVYb1gyeXNi
        Umx6R1Zscno2a1BvY0ZibzhRSnJUQ0EKOnpVmiqHiAR5rjlLYSjLAV2mQuTeUujv
        bo52xmkzh7VvrS3Bmpmeu2BlVM0D2xVQZXCBVIu611dLql+Og5pT3g==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2026-01-07T21:33:07Z"
  mac: ENC[AES256_GCM,data:un+JipHGN09rtjdzw/Wa91RhuJOBz+Cv4D4K/2sKgdV56vficz1UHXAwvXbfCNaYfI/XP5VuyDlfJIzcj/gHo7GyDK8H8rZy3PYng5lG8rShv83O8FSgQCpK5TmWmE/XeXYbNZ/e3r/PaqYvbLwq1U/ZBNHKnMIdGhKe+yEURNo=,iv:RWEma5BGsfC45t3xOFt+/v6PQ+q0gE0vQQM7N+L8FqE=,tag:harH8ks3ylL4tE20KxtJnA==,type:str]
  encrypted_regex: ^(clientId|clientSecret|secret)$
  mac_only_encrypted: true
  version: 3.11.0
