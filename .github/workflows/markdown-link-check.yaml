---
# yamllint disable rule:line-length
name: Markdown Link Check

on:
  workflow_dispatch:
  schedule:
    # Run weekly on Mondays at 00:00 UTC
    - cron: "0 0 * * 1"
  push:
    branches:
      - main
    paths:
      - "README.md"
      - "CLAUDE.md"
      - "PROJECT_INDEX.md"
      - "QUICKSTART.md"
      - "docs/ARCHITECTURE.md"
      - "docs/APPLICATIONS.md"
      - "docs/CONFIGURATION.md"
      - "docs/OPERATIONS.md"
      - "docs/TROUBLESHOOTING.md"
      - "docs/CLI_REFERENCE.md"
      - "docs/NETWORK-INVENTORY.md"
      - "docs/ai-context/**/*.md"
      - ".github/workflows/markdown-link-check.yaml"
      - ".github/workflows/lychee.toml"
  pull_request:
    paths:
      - "README.md"
      - "CLAUDE.md"
      - "PROJECT_INDEX.md"
      - "QUICKSTART.md"
      - "docs/ARCHITECTURE.md"
      - "docs/APPLICATIONS.md"
      - "docs/CONFIGURATION.md"
      - "docs/OPERATIONS.md"
      - "docs/TROUBLESHOOTING.md"
      - "docs/CLI_REFERENCE.md"
      - "docs/NETWORK-INVENTORY.md"
      - "docs/ai-context/**/*.md"
      - ".github/workflows/markdown-link-check.yaml"
      - ".github/workflows/lychee.toml"

jobs:
  markdown-link-check:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Check links in core documentation
        uses: lycheeverse/lychee-action@v2
        with:
          # Explicitly list core documentation files to check
          # Excludes auxiliary docs (guides, research, workflows)
          args: >-
            --verbose
            --no-progress
            --config .github/workflows/lychee.toml
            README.md
            CLAUDE.md
            PROJECT_INDEX.md
            QUICKSTART.md
            AGENTS.md
            docs/ARCHITECTURE.md
            docs/APPLICATIONS.md
            docs/AUDIT_DELIVERABLES.md
            docs/AUDIT_SUMMARY.md
            docs/CLI_REFERENCE.md
            docs/CONFIGURATION.md
            docs/DIAGRAMS.md
            docs/INDEX.md
            docs/NETWORK-INVENTORY.md
            docs/OPERATIONS.md
            docs/PLUGIN_API_REFERENCE.md
            docs/QUICKSTART.md
            docs/TROUBLESHOOTING.md
            'docs/ai-context/*.md'
            'docs/ai-context/patterns/*.md'
          fail: true
          format: markdown
          output: lychee-report.md

      - name: Upload link check report
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: lychee-report
          path: lychee-report.md
          retention-days: 7

      - name: Report results
        if: failure()
        run: |
          echo "::error::Broken links detected in core documentation"
          echo "Check the lychee-report artifact for details"
          exit 1
